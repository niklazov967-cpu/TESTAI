# Чекпоинты проекта

## v0.0.0 - Базовый функционал
**Дата:** Начальная версия  
**Описание:** Базовая версия с трёхэтапной архитектурой и поддержкой титана

### Основные функции:
- Трёхэтапная архитектура (Tavily → DeepSeek → OpenAI)
- Поддержка титана (Ti) в химическом составе
- Поиск аналогов для США, России, Китая
- Валидация и фактчекинг результатов
- Веб-интерфейс
- REST API endpoints

---

## v1.0.0 - Полная локализация и улучшенный UI
**Дата:** Текущая версия  
**Описание:** Полная локализация на русский язык, страница настроек, улучшенный индикатор прогресса

### Основные изменения:

#### Локализация:
- ✅ Все комментарии переведены на русский язык
- ✅ Все console.log сообщения на русском
- ✅ Добавлен автоматический перевод через DeepSeek API
- ✅ Все тексты в результатах переводятся на русский перед сохранением в кэш

#### Страница настроек:
- ✅ Создана страница настроек (`settings.html`) со всеми параметрами:
  - Кэширование
  - Строгость валидации
  - Максимум итераций
  - Максимум результатов Tavily
  - Температура DeepSeek и OpenAI
  - Модель OpenAI
- ✅ Добавлена кнопка сброса кэша
- ✅ Обязательный просмотр промптов и алгоритмов работы системы

#### Индикатор прогресса:
- ✅ Live-обновления через Server-Sent Events (SSE)
- ✅ Таймеры для каждого этапа в реальном времени
- ✅ Общий таймер обработки
- ✅ Отображение количества итераций для каждого этапа:
  - Stage 1: количество запросов
  - Stage 2: количество итераций обработки
  - Stage 3: количество проверок валидации
- ✅ Статусы для каждого этапа с обновлениями в реальном времени

#### Улучшения обработки:
- ✅ Убрана отдельная проверка титана
- ✅ Убрана логика повторных попыток при отсутствии титана
- ✅ Титан обрабатывается как обычный элемент химического состава

#### Новые файлы:
- `public/settings.html` - страница настроек
- `public/settings.js` - логика страницы настроек
- `server/translator.js` - модуль для перевода текстов

#### API:
- ✅ Добавлен endpoint `/api/prompts` для получения промптов
- ✅ Все сообщения API на русском языке

---

## v1.1.0 - Исправлена оценка свариваемости для нержавеющих сталей
**Дата:** Текущая версия  
**Описание:** Исправлена критическая ошибка в оценке свариваемости нержавеющих сталей

### Основные изменения:

#### Исправление оценки свариваемости:
- ✅ Формула CE теперь учитывает класс стали при оценке свариваемости
- ✅ Для аустенитных нержавеющих сталей свариваемость всегда 'excellent' (отличная)
- ✅ Для ферритных и мартенситных нержавеющих сталей свариваемость 'good' (хорошая)
- ✅ Для углеродистых сталей используется стандартная формула CE
- ✅ Исправлено противоречие между карточкой (Сложная) и рекомендациями (Отличная)

#### Обновление промпта валидации:
- ✅ OpenAI теперь понимает, что для нержавеющих сталей формула CE не применима
- ✅ Свариваемость для нержавеющих сталей оценивается по классу, а не по CE
- ✅ Добавлены четкие инструкции по оценке свариваемости для разных классов сталей

#### Технические детали:
- Формула CE = C + (Mn/6) + (Ni/20) + (Cr/10) + (Mo/50) + (V/10) предназначена только для углеродистых сталей
- Для нержавеющих сталей с высоким содержанием Cr и Ni формула дает завышенные значения CE
- Аустенитные нержавеющие стали имеют отличную свариваемость независимо от CE

---

## v1.2.0 - Исправления перевода и улучшенный индикатор прогресса
**Дата:** Текущая версия  
**Описание:** Исправлена причина появления английского текста в кэше, добавлен Stage 4 для перевода

### Основные изменения:

#### Исправление проблемы с переводом:
- ✅ Исправлена причина появления английского текста в кэше
- ✅ Добавлена повторная попытка перевода при неудаче
- ✅ Улучшена проверка успешности перевода перед сохранением в кэш
- ✅ При загрузке из кэша автоматически переводится английский текст
- ✅ Перевод применяется ко всем полям: errors, warnings, recommendations

#### Добавлен Stage 4 для перевода:
- ✅ Перевод вынесен в отдельный этап (Stage 4)
- ✅ Stage 3 теперь только валидация
- ✅ Stage 4 показывает:
  - Статус перевода
  - Таймер этапа
  - Количество переведенных текстов
- ✅ Улучшена визуализация процесса перевода

#### Улучшения индикатора прогресса:
- ✅ Исправлено использование параметра `tavily_max_results`
- ✅ Улучшено отображение информации о результатах поиска:
  - Показывается: "Запросов: 9 | Источников: 94 (получено: 135, дубликатов удалено: 41)"
- ✅ Добавлена детальная информация о результатах поиска

#### Технические детали:
- Параметр `tavily_max_results` теперь правильно передается в Tavily API
- Количество источников может быть меньше запрошенного из-за удаления дубликатов
- Перевод выполняется как отдельный этап с собственным таймером

---

## v1.3.0 - Конвертер стандартов v3.0
**Дата:** Текущая версия  
**Описание:** Добавлена вторая страница для поиска эквивалентных промышленных стандартов

### Основные изменения:

#### Новая страница - Конвертер стандартов:
- ✅ Создана вторая страница (`standards.html`) для поиска эквивалентов стандартов
- ✅ Трёхэтапная архитектура: Tavily → DeepSeek → OpenAI
- ✅ Поддержка только метрических систем (ГОСТ, GB, EN/DIN)
- ✅ Поиск эквивалентов для России, Китая и Европы

#### Модульные промпты:
- ✅ Создано 13 блоков промптов в `prompts/standards_blocks/`
- ✅ Блоки для Stage 2 (DeepSeek): базовый, методология, техническое сравнение, совместимость, материалы, безопасность, экономика
- ✅ Блоки для Stage 3 (OpenAI): базовая валидация, техническая, размерная, материалов, безопасности, практическая
- ✅ Динамическая сборка промптов из активных блоков
- ✅ Пользователь может включать/выключать блоки в настройках

#### Страница настроек стандартов:
- ✅ Создана отдельная страница настроек (`standards-settings.html`)
- ✅ Независимая от настроек сталей
- ✅ 4 пресета: быстрый, сбалансированный, тщательный, критический
- ✅ Настройка параметров поиска (количество запросов, глубина)
- ✅ Настройка блоков промптов
- ✅ Настройка валидации (строгость, минимальный балл, веса критериев)
- ✅ Настройка кэша

#### Валидация:
- ✅ 7 критериев валидации с настраиваемыми весами:
  - Техническая точность (30%)
  - Размерная совместимость (25%)
  - Классы давления/температуры (20%)
  - Эквивалентность материалов (15%)
  - Соответствие регуляциям (5%)
  - Практическая применимость (3%)
  - Безопасность (2%)
- ✅ 4 уровня строгости: relaxed, normal, strict, very_strict
- ✅ Кэширование только после успешной валидации

#### Отслеживание прогресса:
- ✅ Live-обновления через Server-Sent Events (SSE)
- ✅ Таймеры для каждого этапа
- ✅ Отображение количества запросов и источников
- ✅ Визуализация Stage 1 → Stage 2 → Stage 3

#### Backend:
- ✅ Создан `server/standardsEngine.js` - движок поиска стандартов
- ✅ Созданы этапы: `stage1_standards_search.js`, `stage2_standards_process.js`, `stage3_standards_validate.js`
- ✅ Обновлены `config.js`, `cacheManager.js`, `promptBuilder.js` для поддержки стандартов
- ✅ Добавлены роуты `/api/standards/*` в `server.js`
- ✅ Исправлены ошибки в вызовах API клиентов (processData, validate)

#### Новые файлы:
- `public/standards.html` - страница поиска стандартов
- `public/standards-script.js` - логика поиска с SSE
- `public/standards-settings.html` - страница настроек
- `public/standards-settings-script.js` - логика настроек
- `server/standardsEngine.js` - движок поиска
- `server/stages/stage1_standards_search.js` - этап поиска
- `server/stages/stage2_standards_process.js` - этап обработки
- `server/stages/stage3_standards_validate.js` - этап валидации
- `data/standards_config.json` - конфигурация настроек
- `data/standards_cache.json` - кэш результатов
- `prompts/standards_blocks/*.txt` - 13 блоков промптов

#### API:
- ✅ `POST /api/standards/search` - поиск эквивалентов стандартов
- ✅ `GET /api/standards/settings` - получение настроек
- ✅ `POST /api/standards/settings` - обновление настроек
- ✅ `POST /api/standards/settings/reset` - сброс настроек
- ✅ `DELETE /api/standards/cache` - очистка кэша
- ✅ `GET /api/standards/cache/info` - информация о кэше
- ✅ `GET /api/standards/prompts` - просмотр промптов

#### Типы стандартов:
- Фланцы (ГОСТ 12821-80, GB/T 9112-2010, EN 1092-1)
- Сосуды под давлением
- Технические чертежи
- Крепёжные элементы
- Трубопроводы
- Материалы

---

## Как использовать чекпоинты

### Переключиться на чекпоинт:
```bash
git checkout v1.0.0
```

### Вернуться на последнюю версию:
```bash
git checkout main
```

### Создать новую ветку от чекпоинта:
```bash
git checkout -b new-feature v1.0.0
```
